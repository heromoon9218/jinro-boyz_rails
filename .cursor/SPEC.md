# 人狼BOYZ Rails 仕様書（SPECIFICATION）

## 1. 概要

### 1.1 目的
人狼BOYZ は、既存アプリケーション「jinro_rails」をベースとした Web 人狼ゲームアプリケーションである。バックエンド API を提供し、フロントエンド（jinro-boyz_react）と連携して人狼ゲームをプレイできる。

### 1.2 ベースアプリケーション
- **jinro_rails**: オープンソース人狼ゲームアプリケーション
- 本プロジェクトは jinro_rails の設計・実装をベースに、技術スタックの更新およびドメイン設計の変更を行う

### 1.3 技術スタック

| 項目 | バージョン |
|------|------------|
| Ruby | 4.0.1 |
| Ruby on Rails | 8.1.2 |
| Database | MySQL 8.4.8 |
| Redis | 8.6 |
| その他 | Sidekiq（想定） |

### 1.4 バージョン方針

**原則: 常に最新の安定版を使用する。**

- Docker イメージ・ライブラリ・フレームワークは、最新の安定版（Stable / LTS）を採用する
- バージョン固定が必要な場合は、マイナーバージョンまで指定（例: `8.6`）し、パッチは最新に追随する

### 1.5 非目標（本仕様のスコープ外）
- モバイルネイティブアプリ
- 他ゲームモード（標準人狼ルール以外）
- 多言語対応の詳細仕様

---

## 2. ドメイン設計（jinro_rails との差異）

### 2.1 Room の分割

jinro_rails では `Room` エンティティが `room_type` により種類を区別していたが、人狼BOYZ では以下の **3 つの独立したドメイン** に分割・定義する。

| ドメイン | 説明 | 閲覧者 | jinro_rails 対応 |
|----------|------|--------|------------------|
| **MainRoom** | メインルーム（全体チャット） | 全生存者 | Room(room_type: for_all) |
| **DeadRoom** | 霊界ルーム | 死亡者のみ | Room(room_type: for_dead) |
| **WolfRoom** | 人狼専用ルーム | 人狼のみ | Room(room_type: for_wolf) |

### 2.2 設計方針

- 各ルームは **独立したエンティティ** として扱う
- Village は MainRoom / DeadRoom / WolfRoom をそれぞれ 1 つずつ持つ（村作成時に自動作成）
- Post は各ルーム種別に紐づく（main_room_id, dead_room_id, wolf_room_id のいずれか）

---

## 3. 主要エンティティ

| エンティティ | 説明 |
|-------------|------|
| **User** | アプリ利用者。認証・プロフィール・村の作成者として機能 |
| **Village** | 1ゲーム単位。村名・人数・議論時間・ステータスを持つ |
| **Player** | Village に参加した User。役職・生死・ユーザーネームを持つ |
| **MainRoom** | メインルーム。全生存者が参加するチャット |
| **DeadRoom** | 霊界ルーム。死亡者のみが参加するチャット |
| **WolfRoom** | 人狼専用ルーム。人狼のみが参加するチャット |
| **Post** | 各ルーム内のチャット投稿 |
| **Record** | 各日・各プレイヤーの投票・襲撃・占い・護衛の記録 |
| **Result** | 各日の処刑者・襲撃犠牲者・占い結果・護衛対象の確定結果 |

---

## 4. 村（Village）のライフサイクル

jinro_rails と同様のフローを想定。

| status | 説明 |
|--------|------|
| **not_started** | 募集中 |
| **in_play** | 進行中 |
| **ended** | 終了 |
| **ruined** | 廃村 |

---

## 5. 役職・ゲーム進行

jinro_rails と同様の役職（村人、人狼、占い師、霊媒師、騎士、狂人）およびゲーム進行フローを採用。詳細は jinro_rails の仕様を参照。

---

## 6. API 設計方針

- RESTful API
- フロントエンド（jinro-boyz_react）向けに JSON 形式で提供
- ルーム種別に応じたエンドポイントの分割を検討（例: `/api/v1/main_rooms/:id/posts` 等）

---

## 7. データベース

- **RDBMS**: MySQL 8.4.8
- スキーマ設計は別途 TABLE_DESIGN.md を参照（作成予定）

---

## 8. 開発環境

- セットアップ手順は README に記載（作成予定）
- 環境変数: `.env` による設定

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2025-02-21 | 初版作成（人狼BOYZ プロジェクト初期セットアップ） |
